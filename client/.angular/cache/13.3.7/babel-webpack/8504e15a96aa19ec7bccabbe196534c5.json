{"ast":null,"code":"\"use strict\";\n/**\n * Copyright 2017 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvar _asyncToGenerator = require(\"C:\\\\Users\\\\Matth\\\\workspace\\\\angular-ecommerce\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\asyncToGenerator.js\").default;\n\nvar _asyncIterator = require(\"C:\\\\Users\\\\Matth\\\\workspace\\\\angular-ecommerce\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\asyncIterator.js\").default;\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.helper = exports.debugError = void 0;\n\nconst Errors_js_1 = require(\"./Errors.js\");\n\nconst Debug_js_1 = require(\"./Debug.js\");\n\nconst assert_js_1 = require(\"./assert.js\");\n\nconst environment_js_1 = require(\"../environment.js\");\n\nexports.debugError = Debug_js_1.debug('puppeteer:error');\n\nfunction getExceptionMessage(exceptionDetails) {\n  if (exceptionDetails.exception) return exceptionDetails.exception.description || exceptionDetails.exception.value;\n  let message = exceptionDetails.text;\n\n  if (exceptionDetails.stackTrace) {\n    for (const callframe of exceptionDetails.stackTrace.callFrames) {\n      const location = callframe.url + ':' + callframe.lineNumber + ':' + callframe.columnNumber;\n      const functionName = callframe.functionName || '<anonymous>';\n      message += `\\n    at ${functionName} (${location})`;\n    }\n  }\n\n  return message;\n}\n\nfunction valueFromRemoteObject(remoteObject) {\n  assert_js_1.assert(!remoteObject.objectId, 'Cannot extract value when objectId is given');\n\n  if (remoteObject.unserializableValue) {\n    if (remoteObject.type === 'bigint' && typeof BigInt !== 'undefined') return BigInt(remoteObject.unserializableValue.replace('n', ''));\n\n    switch (remoteObject.unserializableValue) {\n      case '-0':\n        return -0;\n\n      case 'NaN':\n        return NaN;\n\n      case 'Infinity':\n        return Infinity;\n\n      case '-Infinity':\n        return -Infinity;\n\n      default:\n        throw new Error('Unsupported unserializable value: ' + remoteObject.unserializableValue);\n    }\n  }\n\n  return remoteObject.value;\n}\n\nfunction releaseObject(_x, _x2) {\n  return _releaseObject.apply(this, arguments);\n}\n\nfunction _releaseObject() {\n  _releaseObject = _asyncToGenerator(function* (client, remoteObject) {\n    if (!remoteObject.objectId) return;\n    yield client.send('Runtime.releaseObject', {\n      objectId: remoteObject.objectId\n    }).catch(error => {\n      // Exceptions might happen in case of a page been navigated or closed.\n      // Swallow these since they are harmless and we don't leak anything in this case.\n      exports.debugError(error);\n    });\n  });\n  return _releaseObject.apply(this, arguments);\n}\n\nfunction addEventListener(emitter, eventName, handler) {\n  emitter.on(eventName, handler);\n  return {\n    emitter,\n    eventName,\n    handler\n  };\n}\n\nfunction removeEventListeners(listeners) {\n  for (const listener of listeners) listener.emitter.removeListener(listener.eventName, listener.handler);\n\n  listeners.length = 0;\n}\n\nfunction isString(obj) {\n  return typeof obj === 'string' || obj instanceof String;\n}\n\nfunction isNumber(obj) {\n  return typeof obj === 'number' || obj instanceof Number;\n}\n\nfunction waitForEvent(_x3, _x4, _x5, _x6, _x7) {\n  return _waitForEvent.apply(this, arguments);\n}\n\nfunction _waitForEvent() {\n  _waitForEvent = _asyncToGenerator(function* (emitter, eventName, predicate, timeout, abortPromise) {\n    let eventTimeout, resolveCallback, rejectCallback;\n    const promise = new Promise((resolve, reject) => {\n      resolveCallback = resolve;\n      rejectCallback = reject;\n    });\n    const listener = addEventListener(emitter, eventName, /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (event) {\n        if (!(yield predicate(event))) return;\n        resolveCallback(event);\n      });\n\n      return function (_x15) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    if (timeout) {\n      eventTimeout = setTimeout(() => {\n        rejectCallback(new Errors_js_1.TimeoutError('Timeout exceeded while waiting for event'));\n      }, timeout);\n    }\n\n    function cleanup() {\n      removeEventListeners([listener]);\n      clearTimeout(eventTimeout);\n    }\n\n    const result = yield Promise.race([promise, abortPromise]).then(r => {\n      cleanup();\n      return r;\n    }, error => {\n      cleanup();\n      throw error;\n    });\n    if (result instanceof Error) throw result;\n    return result;\n  });\n  return _waitForEvent.apply(this, arguments);\n}\n\nfunction evaluationString(fun, ...args) {\n  if (isString(fun)) {\n    assert_js_1.assert(args.length === 0, 'Cannot evaluate a string with arguments');\n    return fun;\n  }\n\n  function serializeArgument(arg) {\n    if (Object.is(arg, undefined)) return 'undefined';\n    return JSON.stringify(arg);\n  }\n\n  return `(${fun})(${args.map(serializeArgument).join(',')})`;\n}\n\nfunction pageBindingInitString(type, name) {\n  function addPageBinding(type, bindingName) {\n    /* Cast window to any here as we're about to add properties to it\n     * via win[bindingName] which TypeScript doesn't like.\n     */\n    const win = window;\n    const binding = win[bindingName];\n\n    win[bindingName] = (...args) => {\n      const me = window[bindingName];\n      let callbacks = me.callbacks;\n\n      if (!callbacks) {\n        callbacks = new Map();\n        me.callbacks = callbacks;\n      }\n\n      const seq = (me.lastSeq || 0) + 1;\n      me.lastSeq = seq;\n      const promise = new Promise((resolve, reject) => callbacks.set(seq, {\n        resolve,\n        reject\n      }));\n      binding(JSON.stringify({\n        type,\n        name: bindingName,\n        seq,\n        args\n      }));\n      return promise;\n    };\n  }\n\n  return evaluationString(addPageBinding, type, name);\n}\n\nfunction pageBindingDeliverResultString(name, seq, result) {\n  function deliverResult(name, seq, result) {\n    window[name].callbacks.get(seq).resolve(result);\n    window[name].callbacks.delete(seq);\n  }\n\n  return evaluationString(deliverResult, name, seq, result);\n}\n\nfunction pageBindingDeliverErrorString(name, seq, message, stack) {\n  function deliverError(name, seq, message, stack) {\n    const error = new Error(message);\n    error.stack = stack;\n    window[name].callbacks.get(seq).reject(error);\n    window[name].callbacks.delete(seq);\n  }\n\n  return evaluationString(deliverError, name, seq, message, stack);\n}\n\nfunction pageBindingDeliverErrorValueString(name, seq, value) {\n  function deliverErrorValue(name, seq, value) {\n    window[name].callbacks.get(seq).reject(value);\n    window[name].callbacks.delete(seq);\n  }\n\n  return evaluationString(deliverErrorValue, name, seq, value);\n}\n\nfunction makePredicateString(predicate, predicateQueryHandler) {\n  function checkWaitForOptions(node, waitForVisible, waitForHidden) {\n    if (!node) return waitForHidden;\n    if (!waitForVisible && !waitForHidden) return node;\n    const element = node.nodeType === Node.TEXT_NODE ? node.parentElement : node;\n    const style = window.getComputedStyle(element);\n    const isVisible = style && style.visibility !== 'hidden' && hasVisibleBoundingBox();\n    const success = waitForVisible === isVisible || waitForHidden === !isVisible;\n    return success ? node : null;\n\n    function hasVisibleBoundingBox() {\n      const rect = element.getBoundingClientRect();\n      return !!(rect.top || rect.bottom || rect.width || rect.height);\n    }\n  }\n\n  const predicateQueryHandlerDef = predicateQueryHandler ? `const predicateQueryHandler = ${predicateQueryHandler};` : '';\n  return `\n    (() => {\n      ${predicateQueryHandlerDef}\n      const checkWaitForOptions = ${checkWaitForOptions};\n      return (${predicate})(...args)\n    })() `;\n}\n\nfunction waitWithTimeout(_x8, _x9, _x10) {\n  return _waitWithTimeout.apply(this, arguments);\n}\n\nfunction _waitWithTimeout() {\n  _waitWithTimeout = _asyncToGenerator(function* (promise, taskName, timeout) {\n    let reject;\n    const timeoutError = new Errors_js_1.TimeoutError(`waiting for ${taskName} failed: timeout ${timeout}ms exceeded`);\n    const timeoutPromise = new Promise((resolve, x) => reject = x);\n    let timeoutTimer = null;\n    if (timeout) timeoutTimer = setTimeout(() => reject(timeoutError), timeout);\n\n    try {\n      return yield Promise.race([promise, timeoutPromise]);\n    } finally {\n      if (timeoutTimer) clearTimeout(timeoutTimer);\n    }\n  });\n  return _waitWithTimeout.apply(this, arguments);\n}\n\nfunction getReadableAsBuffer(_x11, _x12) {\n  return _getReadableAsBuffer.apply(this, arguments);\n}\n\nfunction _getReadableAsBuffer() {\n  _getReadableAsBuffer = _asyncToGenerator(function* (readable, path) {\n    if (!environment_js_1.isNode && path) {\n      throw new Error('Cannot write to a path outside of Node.js environment.');\n    }\n\n    const fs = environment_js_1.isNode ? yield importFSModule() : null;\n    let fileHandle;\n\n    if (path && fs) {\n      fileHandle = yield fs.promises.open(path, 'w');\n    }\n\n    const buffers = [];\n    var _iteratorAbruptCompletion = false;\n    var _didIteratorError = false;\n\n    var _iteratorError;\n\n    try {\n      for (var _iterator = _asyncIterator(readable), _step; _iteratorAbruptCompletion = !(_step = yield _iterator.next()).done; _iteratorAbruptCompletion = false) {\n        const chunk = _step.value;\n        buffers.push(chunk);\n\n        if (fileHandle) {\n          yield fs.promises.writeFile(fileHandle, chunk);\n        }\n      }\n    } catch (err) {\n      _didIteratorError = true;\n      _iteratorError = err;\n    } finally {\n      try {\n        if (_iteratorAbruptCompletion && _iterator.return != null) {\n          yield _iterator.return();\n        }\n      } finally {\n        if (_didIteratorError) {\n          throw _iteratorError;\n        }\n      }\n    }\n\n    if (path) yield fileHandle.close();\n    let resultBuffer = null;\n\n    try {\n      resultBuffer = Buffer.concat(buffers);\n    } finally {\n      return resultBuffer;\n    }\n  });\n  return _getReadableAsBuffer.apply(this, arguments);\n}\n\nfunction getReadableFromProtocolStream(_x13, _x14) {\n  return _getReadableFromProtocolStream.apply(this, arguments);\n}\n/**\n * Loads the Node fs promises API. Needed because on Node 10.17 and below,\n * fs.promises is experimental, and therefore not marked as enumerable. That\n * means when TypeScript compiles an `import('fs')`, its helper doesn't spot the\n * promises declaration and therefore on Node <10.17 you get an error as\n * fs.promises is undefined in compiled TypeScript land.\n *\n * See https://github.com/puppeteer/puppeteer/issues/6548 for more details.\n *\n * Once Node 10 is no longer supported (April 2021) we can remove this and use\n * `(await import('fs')).promises`.\n */\n\n\nfunction _getReadableFromProtocolStream() {\n  _getReadableFromProtocolStream = _asyncToGenerator(function* (client, handle) {\n    // TODO:\n    // This restriction can be lifted once https://github.com/nodejs/node/pull/39062 has landed\n    if (!environment_js_1.isNode) {\n      throw new Error('Cannot create a stream outside of Node.js environment.');\n    }\n\n    const {\n      Readable\n    } = yield Promise.resolve().then(() => __importStar(require('stream')));\n    let eof = false;\n    return new Readable({\n      read(size) {\n        var _this = this;\n\n        return _asyncToGenerator(function* () {\n          if (eof) {\n            return null;\n          }\n\n          const response = yield client.send('IO.read', {\n            handle,\n            size\n          });\n\n          _this.push(response.data, response.base64Encoded ? 'base64' : undefined);\n\n          if (response.eof) {\n            _this.push(null);\n\n            eof = true;\n            yield client.send('IO.close', {\n              handle\n            });\n          }\n        })();\n      }\n\n    });\n  });\n  return _getReadableFromProtocolStream.apply(this, arguments);\n}\n\nfunction importFSModule() {\n  return _importFSModule.apply(this, arguments);\n}\n\nfunction _importFSModule() {\n  _importFSModule = _asyncToGenerator(function* () {\n    if (!environment_js_1.isNode) {\n      throw new Error('Cannot load the fs module API outside of Node.');\n    }\n\n    const fs = yield Promise.resolve().then(() => __importStar(require('fs')));\n\n    if (fs.promises) {\n      return fs;\n    }\n\n    return fs.default;\n  });\n  return _importFSModule.apply(this, arguments);\n}\n\nexports.helper = {\n  evaluationString,\n  pageBindingInitString,\n  pageBindingDeliverResultString,\n  pageBindingDeliverErrorString,\n  pageBindingDeliverErrorValueString,\n  makePredicateString,\n  getReadableAsBuffer,\n  getReadableFromProtocolStream,\n  waitWithTimeout,\n  waitForEvent,\n  isString,\n  isNumber,\n  importFSModule,\n  addEventListener,\n  removeEventListeners,\n  valueFromRemoteObject,\n  getExceptionMessage,\n  releaseObject\n};","map":{"version":3,"sources":["C:/Users/Matth/workspace/node_modules/puppeteer/lib/cjs/puppeteer/common/helper.js"],"names":["__createBinding","Object","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__setModuleDefault","v","value","__importStar","mod","__esModule","result","prototype","hasOwnProperty","call","exports","helper","debugError","Errors_js_1","require","Debug_js_1","assert_js_1","environment_js_1","debug","getExceptionMessage","exceptionDetails","exception","description","message","text","stackTrace","callframe","callFrames","location","url","lineNumber","columnNumber","functionName","valueFromRemoteObject","remoteObject","assert","objectId","unserializableValue","type","BigInt","replace","NaN","Infinity","Error","releaseObject","client","send","catch","error","addEventListener","emitter","eventName","handler","on","removeEventListeners","listeners","listener","removeListener","length","isString","obj","String","isNumber","Number","waitForEvent","predicate","timeout","abortPromise","eventTimeout","resolveCallback","rejectCallback","promise","Promise","resolve","reject","event","setTimeout","TimeoutError","cleanup","clearTimeout","race","then","r","evaluationString","fun","args","serializeArgument","arg","is","JSON","stringify","map","join","pageBindingInitString","name","addPageBinding","bindingName","win","window","binding","me","callbacks","Map","seq","lastSeq","set","pageBindingDeliverResultString","deliverResult","delete","pageBindingDeliverErrorString","stack","deliverError","pageBindingDeliverErrorValueString","deliverErrorValue","makePredicateString","predicateQueryHandler","checkWaitForOptions","node","waitForVisible","waitForHidden","element","nodeType","Node","TEXT_NODE","parentElement","style","getComputedStyle","isVisible","visibility","hasVisibleBoundingBox","success","rect","getBoundingClientRect","top","bottom","width","height","predicateQueryHandlerDef","waitWithTimeout","taskName","timeoutError","timeoutPromise","x","timeoutTimer","getReadableAsBuffer","readable","path","isNode","fs","importFSModule","fileHandle","promises","open","buffers","chunk","push","writeFile","close","resultBuffer","Buffer","concat","getReadableFromProtocolStream","handle","Readable","eof","read","size","response","data","base64Encoded","default"],"mappings":"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","sourcesContent":["\"use strict\";\n/**\n * Copyright 2017 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.helper = exports.debugError = void 0;\nconst Errors_js_1 = require(\"./Errors.js\");\nconst Debug_js_1 = require(\"./Debug.js\");\nconst assert_js_1 = require(\"./assert.js\");\nconst environment_js_1 = require(\"../environment.js\");\nexports.debugError = Debug_js_1.debug('puppeteer:error');\nfunction getExceptionMessage(exceptionDetails) {\n    if (exceptionDetails.exception)\n        return (exceptionDetails.exception.description || exceptionDetails.exception.value);\n    let message = exceptionDetails.text;\n    if (exceptionDetails.stackTrace) {\n        for (const callframe of exceptionDetails.stackTrace.callFrames) {\n            const location = callframe.url +\n                ':' +\n                callframe.lineNumber +\n                ':' +\n                callframe.columnNumber;\n            const functionName = callframe.functionName || '<anonymous>';\n            message += `\\n    at ${functionName} (${location})`;\n        }\n    }\n    return message;\n}\nfunction valueFromRemoteObject(remoteObject) {\n    assert_js_1.assert(!remoteObject.objectId, 'Cannot extract value when objectId is given');\n    if (remoteObject.unserializableValue) {\n        if (remoteObject.type === 'bigint' && typeof BigInt !== 'undefined')\n            return BigInt(remoteObject.unserializableValue.replace('n', ''));\n        switch (remoteObject.unserializableValue) {\n            case '-0':\n                return -0;\n            case 'NaN':\n                return NaN;\n            case 'Infinity':\n                return Infinity;\n            case '-Infinity':\n                return -Infinity;\n            default:\n                throw new Error('Unsupported unserializable value: ' +\n                    remoteObject.unserializableValue);\n        }\n    }\n    return remoteObject.value;\n}\nasync function releaseObject(client, remoteObject) {\n    if (!remoteObject.objectId)\n        return;\n    await client\n        .send('Runtime.releaseObject', { objectId: remoteObject.objectId })\n        .catch((error) => {\n        // Exceptions might happen in case of a page been navigated or closed.\n        // Swallow these since they are harmless and we don't leak anything in this case.\n        exports.debugError(error);\n    });\n}\nfunction addEventListener(emitter, eventName, handler) {\n    emitter.on(eventName, handler);\n    return { emitter, eventName, handler };\n}\nfunction removeEventListeners(listeners) {\n    for (const listener of listeners)\n        listener.emitter.removeListener(listener.eventName, listener.handler);\n    listeners.length = 0;\n}\nfunction isString(obj) {\n    return typeof obj === 'string' || obj instanceof String;\n}\nfunction isNumber(obj) {\n    return typeof obj === 'number' || obj instanceof Number;\n}\nasync function waitForEvent(emitter, eventName, predicate, timeout, abortPromise) {\n    let eventTimeout, resolveCallback, rejectCallback;\n    const promise = new Promise((resolve, reject) => {\n        resolveCallback = resolve;\n        rejectCallback = reject;\n    });\n    const listener = addEventListener(emitter, eventName, async (event) => {\n        if (!(await predicate(event)))\n            return;\n        resolveCallback(event);\n    });\n    if (timeout) {\n        eventTimeout = setTimeout(() => {\n            rejectCallback(new Errors_js_1.TimeoutError('Timeout exceeded while waiting for event'));\n        }, timeout);\n    }\n    function cleanup() {\n        removeEventListeners([listener]);\n        clearTimeout(eventTimeout);\n    }\n    const result = await Promise.race([promise, abortPromise]).then((r) => {\n        cleanup();\n        return r;\n    }, (error) => {\n        cleanup();\n        throw error;\n    });\n    if (result instanceof Error)\n        throw result;\n    return result;\n}\nfunction evaluationString(fun, ...args) {\n    if (isString(fun)) {\n        assert_js_1.assert(args.length === 0, 'Cannot evaluate a string with arguments');\n        return fun;\n    }\n    function serializeArgument(arg) {\n        if (Object.is(arg, undefined))\n            return 'undefined';\n        return JSON.stringify(arg);\n    }\n    return `(${fun})(${args.map(serializeArgument).join(',')})`;\n}\nfunction pageBindingInitString(type, name) {\n    function addPageBinding(type, bindingName) {\n        /* Cast window to any here as we're about to add properties to it\n         * via win[bindingName] which TypeScript doesn't like.\n         */\n        const win = window;\n        const binding = win[bindingName];\n        win[bindingName] = (...args) => {\n            const me = window[bindingName];\n            let callbacks = me.callbacks;\n            if (!callbacks) {\n                callbacks = new Map();\n                me.callbacks = callbacks;\n            }\n            const seq = (me.lastSeq || 0) + 1;\n            me.lastSeq = seq;\n            const promise = new Promise((resolve, reject) => callbacks.set(seq, { resolve, reject }));\n            binding(JSON.stringify({ type, name: bindingName, seq, args }));\n            return promise;\n        };\n    }\n    return evaluationString(addPageBinding, type, name);\n}\nfunction pageBindingDeliverResultString(name, seq, result) {\n    function deliverResult(name, seq, result) {\n        window[name].callbacks.get(seq).resolve(result);\n        window[name].callbacks.delete(seq);\n    }\n    return evaluationString(deliverResult, name, seq, result);\n}\nfunction pageBindingDeliverErrorString(name, seq, message, stack) {\n    function deliverError(name, seq, message, stack) {\n        const error = new Error(message);\n        error.stack = stack;\n        window[name].callbacks.get(seq).reject(error);\n        window[name].callbacks.delete(seq);\n    }\n    return evaluationString(deliverError, name, seq, message, stack);\n}\nfunction pageBindingDeliverErrorValueString(name, seq, value) {\n    function deliverErrorValue(name, seq, value) {\n        window[name].callbacks.get(seq).reject(value);\n        window[name].callbacks.delete(seq);\n    }\n    return evaluationString(deliverErrorValue, name, seq, value);\n}\nfunction makePredicateString(predicate, predicateQueryHandler) {\n    function checkWaitForOptions(node, waitForVisible, waitForHidden) {\n        if (!node)\n            return waitForHidden;\n        if (!waitForVisible && !waitForHidden)\n            return node;\n        const element = node.nodeType === Node.TEXT_NODE ? node.parentElement : node;\n        const style = window.getComputedStyle(element);\n        const isVisible = style && style.visibility !== 'hidden' && hasVisibleBoundingBox();\n        const success = waitForVisible === isVisible || waitForHidden === !isVisible;\n        return success ? node : null;\n        function hasVisibleBoundingBox() {\n            const rect = element.getBoundingClientRect();\n            return !!(rect.top || rect.bottom || rect.width || rect.height);\n        }\n    }\n    const predicateQueryHandlerDef = predicateQueryHandler\n        ? `const predicateQueryHandler = ${predicateQueryHandler};`\n        : '';\n    return `\n    (() => {\n      ${predicateQueryHandlerDef}\n      const checkWaitForOptions = ${checkWaitForOptions};\n      return (${predicate})(...args)\n    })() `;\n}\nasync function waitWithTimeout(promise, taskName, timeout) {\n    let reject;\n    const timeoutError = new Errors_js_1.TimeoutError(`waiting for ${taskName} failed: timeout ${timeout}ms exceeded`);\n    const timeoutPromise = new Promise((resolve, x) => (reject = x));\n    let timeoutTimer = null;\n    if (timeout)\n        timeoutTimer = setTimeout(() => reject(timeoutError), timeout);\n    try {\n        return await Promise.race([promise, timeoutPromise]);\n    }\n    finally {\n        if (timeoutTimer)\n            clearTimeout(timeoutTimer);\n    }\n}\nasync function getReadableAsBuffer(readable, path) {\n    if (!environment_js_1.isNode && path) {\n        throw new Error('Cannot write to a path outside of Node.js environment.');\n    }\n    const fs = environment_js_1.isNode ? await importFSModule() : null;\n    let fileHandle;\n    if (path && fs) {\n        fileHandle = await fs.promises.open(path, 'w');\n    }\n    const buffers = [];\n    for await (const chunk of readable) {\n        buffers.push(chunk);\n        if (fileHandle) {\n            await fs.promises.writeFile(fileHandle, chunk);\n        }\n    }\n    if (path)\n        await fileHandle.close();\n    let resultBuffer = null;\n    try {\n        resultBuffer = Buffer.concat(buffers);\n    }\n    finally {\n        return resultBuffer;\n    }\n}\nasync function getReadableFromProtocolStream(client, handle) {\n    // TODO:\n    // This restriction can be lifted once https://github.com/nodejs/node/pull/39062 has landed\n    if (!environment_js_1.isNode) {\n        throw new Error('Cannot create a stream outside of Node.js environment.');\n    }\n    const { Readable } = await Promise.resolve().then(() => __importStar(require('stream')));\n    let eof = false;\n    return new Readable({\n        async read(size) {\n            if (eof) {\n                return null;\n            }\n            const response = await client.send('IO.read', { handle, size });\n            this.push(response.data, response.base64Encoded ? 'base64' : undefined);\n            if (response.eof) {\n                this.push(null);\n                eof = true;\n                await client.send('IO.close', { handle });\n            }\n        },\n    });\n}\n/**\n * Loads the Node fs promises API. Needed because on Node 10.17 and below,\n * fs.promises is experimental, and therefore not marked as enumerable. That\n * means when TypeScript compiles an `import('fs')`, its helper doesn't spot the\n * promises declaration and therefore on Node <10.17 you get an error as\n * fs.promises is undefined in compiled TypeScript land.\n *\n * See https://github.com/puppeteer/puppeteer/issues/6548 for more details.\n *\n * Once Node 10 is no longer supported (April 2021) we can remove this and use\n * `(await import('fs')).promises`.\n */\nasync function importFSModule() {\n    if (!environment_js_1.isNode) {\n        throw new Error('Cannot load the fs module API outside of Node.');\n    }\n    const fs = await Promise.resolve().then(() => __importStar(require('fs')));\n    if (fs.promises) {\n        return fs;\n    }\n    return fs.default;\n}\nexports.helper = {\n    evaluationString,\n    pageBindingInitString,\n    pageBindingDeliverResultString,\n    pageBindingDeliverErrorString,\n    pageBindingDeliverErrorValueString,\n    makePredicateString,\n    getReadableAsBuffer,\n    getReadableFromProtocolStream,\n    waitWithTimeout,\n    waitForEvent,\n    isString,\n    isNumber,\n    importFSModule,\n    addEventListener,\n    removeEventListeners,\n    valueFromRemoteObject,\n    getExceptionMessage,\n    releaseObject,\n};\n"]},"metadata":{},"sourceType":"script"}